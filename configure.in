# -*- shell-script -*-
dnl Process this file with autoconf to produce a configure script. 

AC_REVISION($Id$)
AC_INIT(dec.c)
AM_INIT_AUTOMAKE(libhsync, 0.5.4)
AM_CONFIG_HEADER(config.h)

AC_LIBTOOL_DLOPEN
AM_PROG_LIBTOOL

AC_CANONICAL_HOST

dnl Checks for programs.
AC_PROG_CC
AC_PROG_CPP
AC_PROG_INSTALL
AC_CHECK_PROG(PYTHON, python, python)

dnl Checks for libraries.
dnl AC_CHECK_LIB(z, deflate)

AC_SEARCH_LIBS(connect, [nsl socket inet], [ net_libs="$net_libs -lnsl" ])

dnl Check for declarations
AC_MSG_CHECKING(for sockaddr.sin_len)
AC_EGREP_HEADER(sin_len, sys/socket.h, 
	[ AC_DEFINE(HAVE_SOCK_SIN_LEN)
          AC_MSG_RESULT(yes) ],
        [ AC_MSG_RESULT(no) ])

AC_ARG_ENABLE(ccmalloc,
	[  --enable-ccmalloc       use ccmalloc debugger (default no)],
	[ LIBS="$LIBS -lccmalloc -ldl" ])

AC_ARG_ENABLE(trace,
        [  --disable-trace         turn off library tracing])
AC_MSG_CHECKING("whether to include trace code")
if test "$enable_trace" = "yes" -o -z "$enable_trace"
then
    AC_MSG_RESULT(yes)
    AC_DEFINE(DO_HS_TRACE)
elif test "$enable_trace" = "no"
then
    AC_MSG_RESULT(no)
else
    AC_MSG_RESULT(failed)
    AC_MSG_ERROR("--enable-trace must be set to yes or no")
fi

# TODO: Check for stdint.h.  If it's missing, try to find definitions of 
# critical integer types through other means.

dnl Checks for header files.
AC_HEADER_STDC

# libtool library versioning
libhsync_libversion=1:0:0
AC_DEFINE_UNQUOTED(HS_LIBVERSION, "$libhsync_libversion")

AC_SUBST(libhsync_libversion)
AC_SUBST(OBJ_SAVE)
AC_SUBST(OBJ_RESTORE)
AC_SUBST(CC_SHOBJ_FLAG)
AC_SUBST(CCMALLOC_LIB)
AC_SUBST(net_libs)

AC_OUTPUT(./Makefile)
